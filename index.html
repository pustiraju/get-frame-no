<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Frame No Extractor</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-md text-center">
    <h2 class="text-2xl font-bold text-gray-700 mb-6">Upload Image to Extract Frame No</h2>

    <!-- Unified Drop & Upload Zone -->
    <div id="dropZone" 
      class="relative flex items-center justify-center w-full h-80 border-2 border-dashed border-gray-400 rounded-lg text-gray-500 cursor-pointer transition hover:border-blue-500 hover:text-blue-500 overflow-hidden"
    >
      <span id="dropText" class="absolute z-10">Drag & drop an image here or click to select</span>
      <img id="previewImg" class="absolute inset-0 w-full h-full object-contain hidden" />
    </div>
    <input type="file" id="fileInput" class="hidden" accept="image/*">

    <!-- Result -->
    <h3 class="text-lg font-semibold text-gray-700 mt-6">Frame No:</h3>
    <pre id="result" class="bg-gray-100 p-3 rounded-lg text-gray-800 mt-2"></pre>


     <!-- Auto-copy toggle -->
    <button id="autoCopyBtn" class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg transition">
      Auto Copy: OFF
    </button>
  </div>

  <script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");
    const dropText = document.getElementById("dropText");
    const previewImg = document.getElementById("previewImg");
    const result = document.getElementById("result");
    const autoCopyBtn = document.getElementById("autoCopyBtn");

    let selectedFile = null;
    let autoCopy = false;

    // Toggle auto-copy
    autoCopyBtn.addEventListener("click", () => {
      autoCopy = !autoCopy;
      autoCopyBtn.innerText = `Auto Copy: ${autoCopy ? "ON" : "OFF"}`;
      autoCopyBtn.classList.toggle("bg-green-400", autoCopy);
      autoCopyBtn.classList.toggle("bg-gray-300", !autoCopy);
    });

    function handleFile(file) {
      selectedFile = file;

      const reader = new FileReader();
      reader.onload = (e) => {
        previewImg.src = e.target.result;
        previewImg.classList.remove("hidden");
        dropText.classList.add("hidden");
      };
      reader.readAsDataURL(file);

      uploadImage();
    }

    async function uploadImage() {
      if (!selectedFile) return;

      const formData = new FormData();
      formData.append("image", selectedFile);

      try {
        const response = await fetch(
          "https://m605ue3bva.execute-api.ap-south-1.amazonaws.com/get-frame-no",
          { method: "POST", body: formData }
        );

        const data = await response.json();
        const frameNo = data.frameNo || "Not found";
        result.innerText = frameNo;

        if (autoCopy && frameNo !== "Not found") {
          await navigator.clipboard.writeText(frameNo);
          console.log(`Copied to clipboard: ${frameNo}`);
        }
      } catch (err) {
        console.error(err);
        alert("Error extracting Frame No");
      }
    }

    // Click to open file selector (reset before click)
    dropZone.addEventListener("click", () => {
      fileInput.value = null; // reset input
      fileInput.click();
    });

    // Handle file input change
    fileInput.addEventListener("change", (e) => {
      if (e.target.files.length > 0) handleFile(e.target.files[0]);
    });

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("border-blue-500", "text-blue-500", "bg-blue-50");
    });

    dropZone.addEventListener("dragleave", () => {
      dropZone.classList.remove("border-blue-500", "text-blue-500", "bg-blue-50");
    });

    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("border-blue-500", "text-blue-500", "bg-blue-50");
      if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
    });
  </script>
</body>
</html>
